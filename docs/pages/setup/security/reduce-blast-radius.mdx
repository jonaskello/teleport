---
title: Reducing the Blast Radius of Attacks
description: You can easily configure Teleport to minimize the scope of security breaches
---

Teleport encourages users to practice defense in depth so that every component of their infrastructure is protected against an attack, even if the attack is partially successful. You can configure Teleport to add layers of protection to your cluster when users authenticate or request elevated privileges. In this guide, we will show you how to:

- [Make MFA mandatory for `tsh` logins](#make-mfa-mandatory-for-tsh-login)
- [Present an MFA challenge for every attempt to access a resource](#present-an-mfa-challenge-for-every-attempt-to-access-a-resource)
- [Require multiple reviews for role requests](#require-multiple-reviews-for-role-requests)
- [Automatically prevent some roles from requesting others](#automatically-prevent-some-roles-from-requesting-others)


## Make MFA mandatory for `tsh login`
If a user sets up an account to authenticate to their Teleport cluster with only a password, an adversary can [gain access](/blog/no-passwords) to the password using brute-force attacks, person-in-the-middle attacks, or phishing. But even if a user's password is compromised, you can stop an attacker from authenticating with it when they run `tsh login`. 

For clusters that use the [local authentication connector](/docs/setup/reference/authentication/#local), Teleport lets you make it mandatory for a user to enroll an MFA device when they create an account, and to authenticate using that device when they begin a new Teleport session. To do so, add the following to your Teleport [configuration file](/docs/setup/reference/config):

```yaml
auth_service:

    authentication:
        type: local
        second_factor: <factor type>
```

To make MFA mandatory for all users, `second_factor` must be set to one of the following values:

- `otp`
- `u2f`
- `webauthn`
- `on`

Choose `on` if you would like to require MFA for all users while letting them choose an OTP, U2F, or WebAuthn device. The other options restrict users to a single type of MFA device, which is useful for enforcing a particular standard of security. Once you start the Teleport [proxy service](/docs/architecture/proxy/) with the `second_factor` configuration option set to one of these values, Teleport will mandate MFA by:

- Adjusting the Teleport [signup page](/docs/getting-started/linux-server/#step-24-create-a-teleport-user-and-set-up-two-factor-authentication) so a user must enroll an MFA device of the kind you have selected. If the value of `second_factor` is `on`, users will have the option to select from multiple device types.

- Presenting the user with an MFA challenge when they run `tsh login`

For authentication connectors besides `local`, you must make MFA mandatory via your identity provider. For example, Teleport clusters using [GitHub for SSO](/docs/setup/admin/github-sso/) can require users in their organization to enroll an MFA device by adjusting their [organization-level settings](https://docs.github.com/en/organizations/keeping-your-organization-secure/requiring-two-factor-authentication-in-your-organization).


## Present an MFA challenge for every attempt to access a resource
After a user logs into a Teleport cluster, they can request access to a particular resource, e.g., a node, database, application, or Kubernetes cluster. In this case, the Teleport [Auth Service](/docs/architecture/authentication/) issues a single-use certificate for accessing that resource. You can prevent attackers from doing damage with a compromised certificate by enabling [per-session MFA](/docs/access-controls/guides/per-session-mfa/). 

With this setting, whenever a user requests a one-time certificate to access a resource, the Teleport Auth Service will issue an MFA challenge, even if the user has already begun a Teleport session via `tsh login`. To enable per-session MFA for all users, make the following change to your Teleport configuration file:

```yaml
auth_service:
    authentication:
        require_session_mfa: yes
```

The `require_session_mfa` setting [only applies](/docs/access-controls/guides/per-session-mfa/) to users who have already established a Teleport session. To require MFA for `tsh login`, see the [previous section](#make-mfa-mandatory-for-tsh-login). 


## Require multiple reviews for role requests
Even if an attacker gains access to a user's credentials and successfully signs into your Teleport cluster, you can still prevent the user from escalating their privileges. If you enable [dual authorization](/docs/access-controls/guides/dual-authz/), users who request to assume a particular role must obtain permission to do so from two or more reviewers. This way, if a malicous user manages to impersonate a legitimate one, reviewers can contact the real user before granting the new role.

Dual authorization uses Teleport's [access plugins](/docs/enterprise/workflow/)—e.g., Slack, JIRA, and PagerDuty—to notify reviewers that a user has requested a role. Plugins are applications that communicate with your Teleport cluster via [gRPC](https://grpc.io/). Teleport's Auth Service broadcasts role request notifications to your access plugins, which handle the messages and notify users. For access plugins that require a SAML or OIDC [connector](/docs/enterprise/sso/#configuring-sso), you must enable the Cloud or Enterprise versions of Teleport.

You can [set up](/docs/access-controls/guides/dual-authz/#dual-authorization-1) dual authorization by applying two [role templates](/docs/access-controls/guides/role-templates/):

- [The reviewer](#the-reviewer)
- [The reviewee](#the-reviewee)

### The reviewer
You can enable some users to review other users' role escalation requests by applying a role template similar to the following:

```yaml
kind: role
version: v4
metadata:
  name: <role name>
spec:
  allow:
    review_requests:
      roles: ["role-one", "role-two", "role-three"]
```

Assign `spec.allow.review_requests.roles` to a list of role names. When a user with the role in `metadata.name` requests access to one of the roles listed in `spec.allow.review_requests.roles`, your Teleport access plugins notify reviewers of the request and relay their response to your Teleport cluster.

### The reviewee
You can require a user to request access from reviewers by applying a role template similar to the following:

```yaml
kind: role
version: v4
metadata:
  name: <role name>
spec:
  allow:
    request:
      roles: ["role-one", "role-two", "role-three"]
      thresholds:
        - approve: 2
          deny: 1
```

The `spec.allow.request.roles` field lists the names of other roles that a user with this role can request. When such a user [requests access](/docs/enterprise/workflow/#access-requests-setup) to one of these roles, Teleport requests a review via your access plugins. The `spec.allow.requests.roles.thresholds` field indicates how many reviews are required to approve or deny the request.


## Automatically prevent some roles from requesting others
In theory, a malicious Teleport user could request a more privileged role and trick a reviewer into granting access. You can prevent such a scenario by defining role templates that prohibit users from even requesting access to particular roles.

The `spec.deny` field has the same possible properties as the `spec.allow` field we described [earlier](#require-multiple-reviews-for-role-requests) except, rather than enabling actions, this field disables them. For example, the `spec.deny.requests.roles` field is a list of roles that a user is prohibited from requesting.

As an illustration, we have assigned user `myuser` to the `user` role, which we defined using the following template:

```yaml
kind: role
version: v4
metadata:
  name: user
spec:
  deny:
    request:
      roles: ['admin']

```

Next, `myuser` attempts to request the `admin` role.

```
tsh request create --roles=admin
```

However, the Auth Service denies the request.

```
root@myhost:/# tsh request create --roles=admin
Creating request...
ERROR: user "myuser" can not request role "admin"
```